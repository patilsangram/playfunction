<div class="container-fluid">
	{%- from "templates/print_formats/standard_macros.html" import add_header, render_field -%}

		<div id="header-html" >

            <div >
				<!-- <img id="logo_img" src="assets/playfunction/images/logo.png" > -->
			</div>

  		</div>
			<div id="header-html" >
	      <div style="margin-left:35px;margin-top:-8px;">
					<img id="logo_img" src="/files/logo.png" style="height:130px;width:170px;" >
				</div>
				<div id="header" style="margin-right: -32px" >
				 <b>חשבונית מס קבלה</b>
				</div>
	  		</div>

		<div class="row ">
			<div class="col-xs-4">
				<div class="text-right">
					<font size=2>  </font>
					<p style="margin-top: 1px; margin-left: 27%; font-size:2">{{ frappe.utils.formatdate(doc.get_formatted('posting_date'), "dd/mm/yyyy") }}
						<b> : תאריך</b>
					</p>
					<hr align="right"  style="width:73%; color: #000000; margin-top: 10px;" />
					<p style="margin-top: 1px; margin-left: 27%; font-size:2">
						<span> #1214324 </span>
						<b>  : מספרכם </b>
					</p>
					<p style="margin-top: 1px; margin-left: 27%; font-size:2">
						<span>15/788723 </span>
						<b>  : מספר</b>
	    			</p>
				</div>
			    <!--<p style="text-decoration: underline;text-underline-position: under; "><small>Proposal is valid for 14 days from the date shown</small></p>-->

			</div>
			<div class="col-xs-8">
				<div class="pull-right text-right">
					<font size=4><b>לכבוד</b></font><br>
					<font size=2><b>{{ doc.customer }}</b></font>
					<p>{{ doc.address_display}}</p>
				</div>
				<div class="">

				</div>

			</div>

		</div>

		<br><br>

		<div class="row">
			<div class="col-xs-12">
				<table style="width:100%;margin-bottom:50px;">
					<thead>
						<tr>
							<th style="text-align:left;border:1px solid;">{{ _("#") }}</th>
							<th style="text-align:left;border:1px solid;">{{ _("מס' פריט") }}</th>
							<!--<th></th>-->
							<th style="text-align:left;border-top:1px solid;">{{ _("תאור פריט") }}</th>
							<th style="border-top:1px solid;"></th>
							<th style="text-align:right;border:1px solid;">{{ _("כמות") }}</th>
							<!-- <th style="text-align:right;">{{ _("Disc.%") }}</th> -->
							<th style="text-align:right;border:1px solid;">{{ _("נטו ליחידה") }}</th>
							<!-- <th style="text-align:right;">{{ _("Cost with Disc.") }}</th> -->
							<th style="text-align:right;border:1px solid;">{{ _("סך הכל נטו") }}</th>
						</tr>
					</thead>
					<tbody >
						{% set cnt=namespace(count=1) %}
						{% for item in doc.items %}
						<tr>
							<td style="text-align:left;border:1px solid;">{{ cnt.count }}</td>
							{% set cnt.count=cnt.count+1 %}
							<td style="text-align:left;border:1px solid;">{{ item.item_code }}</td>
							<!-- <td style="text-align:left;"><img id="item_img" src= '{{ item.image }}'></td> -->
							<td colspan="2" style="text-align:left;border:1px solid;" >{{ item.item_name }}</td>
							<td style="text-align:right;border:1px solid;">{{ item.qty }}</td>
							<!-- <td style="text-align:right;">{{ item.discount_percentage }}%</td> -->

							<td style="text-align:right;border:1px solid;">{{ '%0.2f' % item.price_list_rate|float }}</td>
							<td style="text-align: right;border:1px solid;">{{ '%0.2f' % item.amount|float }}</td>
						</tr>
						{% endfor %}

					</tbody>
					<tfoot style="text-align: right;line-height: 5pt;">
						<tr>
							<td></td>
						</tr>
						<tr style="margin-top:10px;">
							<td colspan="4"></td>
							<td style="font-size: 12" colspan="2"><b> {{ _("סך הכל ללא מע\"מ:") }}</b></td>
							<td><b>{{ '%0.2f' % doc.total|float }}</b></td>
						</tr>
						<tr>
							<td colspan="4"></td>
							<td colspan="2"><b> {{ _("הנחה:") }}</b></td>
							{% set disc=doc.total*doc.additional_discount_percentage/100 %}
							<td><b>{{ '%0.2f' % disc|float }}</b></td>
						</tr>
						<tr>
							<td colspan="4"></td>
							<td colspan="2"> <b>{{ _("סה\"כ לאחר הנחה:") }}</b></td>
							{% set total_aftr_disc=doc.total-disc %}
							<td><b>{{ '%0.2f' % total_aftr_disc|float }}</b></td>
						</tr>
						<tr>
							<td colspan="4"></td>
							<td colspan="2"><b>{{ _("מע\"מ:") }}</b> <b class='small'>{{ _("17%") }}</b></td>
							{% set tax=0 %}
							{%  if doc.taxes_and_charges %}
								{% set word = doc.taxes_and_charges.split(' ') %}
								{% if word[0]=="VAT" and word[1]=="17" %}
									{% set tax=total_aftr_disc*0.17 %}
								{% endif %}
							{% endif %}
							<td><b>{{ '%0.2f' % tax|float }}</b></td>
						</tr>
						<tr>
							<td colspan="4"></td>
							<td id="total" colspan="2"> <b>{{ _("סה\"כ לתשלום") }}</b></td>
							{% set grand_total=total_aftr_disc+tax %}
							<td id="total"><b>{{ '%0.2f' % grand_total|float }}</b></td>
						</tr>
					</tfoot>
				</table>
			</div>
		<div>
			<div class="col-xs-12" >
				<table style="width:100%;">
					<thead>
						<tr>
							<th style="text-align:left;border:1px solid; ">{{ _("#") }}</th>
							<th style="text-align:left;border:1px solid; ">{{ _("פרטים") }}</th>
							<th style="text-align:left;border:1px solid;">{{ _("סוג תשלום") }}</th>
							<th style="text-align:right;border:1px solid;">{{ _("מס\' שיק") }}</th>
							<th style="text-align:right;border:1px solid;">{{ _("ת. פרעון") }}</th>
							<th style="text-align:left; border:1px solid;">{{ _("בנק") }}</th>
							<th style="text-align:left; border:1px solid;">{{ _("סניף") }}</th>
							<th style="text-align:left; border:1px solid;">{{ _("מספר חשבון") }}</th>
							<th style="text-align:right; border:1px solid;">{{ _("סכום") }}</th>
						</tr>
					</thead>
					<tbody>
						{% set pay_ref=frappe.db.get_value("Payment Entry Reference", {"reference_name":doc.name} , ["parent", "reference_name","allocated_amount"], as_dict=true) %}


						{% set t=namespace(total=0) %}
						{% set cnt=namespace(count=1) %}
						{% if pay_ref %}
							{% set pay_entry=frappe.db.get_value("Payment Entry", {"name":pay_ref['parent']} , ["mode_of_payment", "reference_no","posting_date","bank","paid_from","bank_account_no"], as_dict=true) %}

						<tr>
							<td style="text-align:left; border:1px solid;">{{ cnt.count }}</td>
							{% set cnt.count=cnt.count+1 %}
							<td style="text-align:left; border:1px solid;">{{ pay_ref.reference_name }}</td>
							<td style="text-align:left; border:1px solid;" >{{ pay_entry.mode_of_payment }}</td>
							<td style="text-align:right;border:1px solid;">{{ pay_entry.reference_no }}</td>
							<td style="text-align:right;border:1px solid;">{{ pay_entry.posting_date }}</td>
							<td style="text-align:left; border:1px solid;">{{ pay_entry.bank }}</td>
							<td style="text-align:left; border:1px solid;">{{ pay_entry.paid_from }}</td>
							<td style="text-align:left; border:1px solid;">{{ pay_entry.bank_account_no }}</td>
							<td style="text-align:right; border:1px solid;">{{ pay_ref.allocated_amount }}</td>

							{% set t.total=t.total+pay_ref.allocated_amount %}
						</tr>
						{% endif %}
					</tbody>
					<tfoot style="text-align: right;">
						<tr>
							<td></td>
						</tr>
						<tr>
							<td colspan="7"></td>
							<td id="total" > <b>{{ _("Total :") }}</b></td>
							<td id="total" ><b>{{ t.total }}</b></td>
						</tr>
					</tfoot>
				</table>
			</div>
		<div id="footer-html" class="visible-pdf">
			{% if not no_letterhead and footer %}
				<div class="letter-head-footer">
					{{ footer }}
				</div>
			{% endif %}

		<div class="row">
			<div class="col-xs-12"></div>
			<div class="col-xs-12" style="direction:rtl;" >
				<p id="terms"><small >
				<b>זיכוי תקף לשנתיים מתאריך החשבונית</b>
				</small></p>

				<hr style="border: 3px solid orange;">
			</div>
		</div>
		<div class="row" style="direction:rtl;">
			<small>
				<div class="col-xs-12">
					<div class="col-xs-5">
						<span style="float:left;margin-left:10px">
							<b>Business no.:</b> ח.פ. 514972330 &emsp;&emsp;
							<b>  טלפון :</b> 2-650-6262
						</span>
					</div>
					<div class="col-xs-7">
						<b>Playfunction :</b> פליי פאנקשן ישראל בע"מ תכלת מרדכי 21 משרד מספר 1202 ירושלים 9439645 &emsp;&emsp;
					</div>
				</div>
			</small>
		</div>
</div>
